<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°„é¾é–€ Pro - æ——è‰¦æ­£å¼ç‰ˆ</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --gold: #d4af37; --dark-green: #1a472a; --card-red: #e74c3c; }
        body { background: var(--dark-green); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; padding: 10px; overflow-x: hidden; }
        .game-container { max-width: 1000px; margin: auto; }
        
        /* ç©å®¶åˆ—è¡¨èˆ‡æˆ¿ä¸» UI */
        .player-toggle-btn { background: rgba(0,0,0,0.5); border: 1px solid var(--gold); color: var(--gold); padding: 5px 15px; border-radius: 20px; margin-bottom: 10px; cursor: pointer; }
        .player-list { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; min-height: 50px; }
        .player-card { background: rgba(0,0,0,0.8); padding: 8px; border-radius: 10px; border: 2px solid #444; width: 115px; position: relative; font-size: 0.9rem; }
        .player-card.active { border-color: var(--gold); box-shadow: 0 0 10px var(--gold); background: rgba(212, 175, 55, 0.1); }
        .player-balance { color: #2ecc71; font-weight: bold; }
        .timer-display { color: #ff7675; font-size: 0.8rem; font-weight: bold; margin-top: 3px; }
        
        /* çš‡å† èˆ‡è¸¢äººæŒ‰éˆ•é‚è¼¯ */
        .is-host-icon { color: var(--gold); margin-left: 3px; }
        .kick-btn { position: absolute; top: -5px; right: -5px; background: #e74c3c; color: white; border-radius: 50%; width: 22px; height: 22px; border: 1px solid white; display: none; cursor: pointer; font-size: 14px; font-weight: bold; line-height: 18px; z-index: 5; }
        /* åªæœ‰æˆ¿ä¸»èƒ½çœ‹åˆ°è¸¢äººæŒ‰éˆ•ï¼Œä½†æˆ¿ä¸»ä¸èƒ½çœ‹åˆ°è‡ªå·±çš„è¸¢äººæŒ‰éˆ• */
        body.is-host .player-card:not(.is-me) .kick-btn { display: block; }

        .board { background: radial-gradient(circle, #2d5a3c 0%, #1a472a 100%); padding: 20px; border-radius: 40px; border: 4px solid var(--gold); margin-top: 10px; }
        .pool-display { font-size: 40px; color: #f1c40f; font-weight: bold; margin: 5px 0; }
        .cards { display: flex; justify-content: center; gap: 10px; margin: 15px 0; height: 140px; }
        .card { width: 90px; height: 130px; background: white; border-radius: 10px; color: black; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 30px; font-weight: bold; border: 2px solid #333; box-shadow: 3px 3px 8px rgba(0,0,0,0.3); white-space: pre-wrap; }
        .card.hidden { background: #2c3e50; color: transparent; border: 1px solid #7f8c8d; }
        .card.red { color: var(--card-red); }

        /* è¨­å®šå€ */
        .setup-box { background: rgba(0,0,0,0.8); padding: 20px; border-radius: 20px; border: 2px solid var(--gold); margin-bottom: 15px; }
        .input-group { margin: 10px 0; display: flex; justify-content: center; align-items: center; gap: 8px; flex-wrap: wrap; }
        input[type="number"], select { padding: 8px; border-radius: 5px; border: none; text-align: center; }
        button { padding: 10px 15px; cursor: pointer; background: var(--gold); border: none; font-weight: bold; border-radius: 6px; color: #1a472a; margin: 3px; }

        /* è¡¨æƒ…å»£æ’­ */
        #emoji-broadcast-area { position: fixed; top: 35%; left: 50%; transform: translate(-50%, -50%); pointer-events: none; z-index: 10000; }
        .broadcast-item { background: rgba(0,0,0,0.85); color: var(--gold); padding: 10px 20px; border-radius: 30px; margin-bottom: 5px; font-weight: bold; border: 2px solid var(--gold); animation: fadeUp 2.5s forwards; box-shadow: 0 0 15px rgba(0,0,0,0.5); }
        @keyframes fadeUp { 0% { opacity: 0; transform: translateY(20px); } 15% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-50px); } }

        /* ç±Œç¢¼ */
        .chip-container { display: flex; justify-content: center; gap: 8px; margin: 10px 0; flex-wrap: wrap; }
        .chip-btn { background: none; border: none; padding: 0; cursor: pointer; transition: 0.1s; }
        .chip-btn img { width: 55px; height: 55px; border-radius: 50%; box-shadow: 0 4px 6px rgba(0,0,0,0.5); object-fit: cover; }
        .chip-btn:active { transform: scale(0.85); }
        #bet-amount { background: #222; color: var(--gold); border: 2px solid var(--gold); font-size: 1.3rem; width: 100px !important; border-radius: 8px; font-weight: bold; }

        .emoji-btn { font-size: 1.5rem; background: rgba(0,0,0,0.3); border: 1px solid #555; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; }
        #all-in-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; pointer-events: none; }
    </style>
</head>
<body>

<div id="emoji-broadcast-area"></div>
<div id="all-in-overlay"><div id="video-box"></div><h1 style="color:var(--gold); margin-top: 20px;">æˆ‘è¦å…¨éƒ¨ï¼ï¼ï¼</h1></div>

<div class="game-container">
    <h1>ğŸŸï¸ åŸ”å¢˜é‡‘é¾é–€ Pro</h1>
    
    <div id="setup-area" class="setup-box">
        <div id="login-part">
            <input type="text" id="my-name" placeholder="è¼¸å…¥æš±ç¨±">
            <button onclick="joinRoom()">é€²å…¥å¤§å»³</button>
        </div>
        <div id="host-part" style="display:none;">
            <h3>ğŸ‘‘ æˆ¿ä¸»è¦å‰‡è¨­å®š</h3>
            <div class="input-group">
                åˆå§‹æœ¬é‡‘: <input type="number" id="start-balance" value="1000" style="width:80px;">
                é–‹å±€åº•æ³¨: <input type="number" id="entry-fee" value="100" style="width:70px;">
            </div>
            <div class="input-group">
                æ£„ç‰ŒæŠ•æ³¨: <input type="number" id="fold-penalty" value="20" style="width:70px;">
                ç‰Œçµ„æ•¸é‡: <select id="deck-count">
                    <option value="1">1 å‰¯ç‰Œ</option><option value="2" selected>2 å‰¯ç‰Œ</option>
                    <option value="3">3 å‰¯ç‰Œ</option><option value="4">4 å‰¯ç‰Œ</option>
                </select>
            </div>
            <div class="input-group">
                <label><input type="checkbox" id="auto-refill" checked> æ± é‡‘ä¸è¶³è‡ªå‹•è£œåº•</label>
            </div>
            <button onclick="hostStartGame()" style="background:#2ecc71; color:white; width: 90%; font-size: 1.1rem;">âœ… ç¢ºèªä¸¦é–‹æ¡Œ</button>
        </div>
    </div>

    <button class="player-toggle-btn" onclick="togglePlayers()">ğŸ‘¥ é¡¯ç¤º/éš±è—ç©å®¶åˆ—è¡¨</button>
    <div id="player-area-wrapper"><div id="player-area" class="player-list"></div></div>

    <div id="main-board" class="board" style="display:none;">
        <div class="emoji-bar">
            <button class="emoji-btn" onclick="sendEmoji('ğŸ˜‚')">ğŸ˜‚</button>
            <button class="emoji-btn" onclick="sendEmoji('ğŸ”¥')">ğŸ”¥</button>
            <button class="emoji-btn" onclick="sendEmoji('ğŸ’¸')">ğŸ’¸</button>
            <button class="emoji-btn" onclick="sendEmoji('ğŸ’©')">ğŸ’©</button>
            <button class="emoji-btn" onclick="sendEmoji('ğŸƒ')">ğŸƒ</button>
        </div>

        <div class="pool-display">ğŸ’° $<span id="pool-val">0</span></div>
        <div id="status-msg">ç­‰å¾…ç™¼ç‰Œ...</div>
        
        <div class="cards">
            <div id="c1" class="card hidden">?</div>
            <div id="c3" class="card hidden">?</div>
            <div id="c2" class="card hidden">?</div>
        </div>

        <div id="controls">
            <div id="bet-controls" style="display:none;">
                <div class="chip-container">
                    <button class="chip-btn" onclick="addBet(10)"><img src="pic/m10.jpg"></button>
                    <button class="chip-btn" onclick="addBet(50)"><img src="pic/m50.jpg"></button>
                    <button class="chip-btn" onclick="addBet(100)"><img src="pic/m100.jpg"></button>
                    <button class="chip-btn" onclick="addBet(500)"><img src="pic/m500.jpg"></button>
                    <button class="chip-btn" onclick="addBet(1000)"><img src="pic/m1000.jpg"></button>
                </div>
                <div style="margin-bottom: 10px;">
                    ä¸‹æ³¨é‡‘é¡ï¼š<input type="number" id="bet-amount" value="0" readonly>
                    <button onclick="document.getElementById('bet-amount').value=0" style="background:#555;">æ¸…ç©º</button>
                </div>
                <div id="action-buttons" style="display:inline-block;">
                    <button id="shoot-normal" onclick="handleAction('shoot')">å°„é–€ï¼</button>
                    <div id="guess-buttons" style="display:none;">
                        <button onclick="handleAction('up')" style="background:#3498db; color:white;">çŒœå¤§</button>
                        <button onclick="handleAction('down')" style="background:#e67e22; color:white;">çŒœå°</button>
                    </div>
                </div>
                <button onclick="setAllIn()" style="background:var(--card-red); color:white;">ALL IN</button>
                <button onclick="handleAction('fold')" style="background:#95a5a6;">æ”¾æ£„ ($<span id="fold-cost-ui">0</span>)</button>
            </div>
            <div id="player-deal-btn" style="display:none;">
                <button onclick="drawGoalPost()" style="background: #2ecc71; color: white; font-size: 1.2rem; padding: 12px 30px;">â™  ç«‹å³ç™¼ç‰Œ â™£</button>
            </div>
            <div id="host-controls" style="margin-top:20px; display:none; border-top:1px solid #555; padding-top:10px;">
                <button onclick="hostResetToLobby()" style="background: #e74c3c; color: white;">ğŸš¨ é‡è£½å›è¨­å®šç•«é¢</button>
            </div>
        </div>
        <p style="font-size: 12px; color: #aaa;">ğŸ´ ç‰Œåº«å‰©é¤˜: <span id="cards-left">0</span></p>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDzd-2ZUgrDM8K_85_qSOgpkWuWNzBUBL8",
        authDomain: "dargongatepoker.firebaseapp.com",
        databaseURL: "https://dargongatepoker-default-rtdb.firebaseio.com",
        projectId: "dargongatepoker",
        storageBucket: "dargongatepoker.firebasestorage.app",
        messagingSenderId: "204663560828",
        appId: "1:204663560828:web:9ede7b6190babde73f07f9"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const gameRef = db.ref('dragonGate/room1');

    let myId = localStorage.getItem('dg_id') || "";
    let localData = {};
    let lastEffectId = "INITIAL"; // é¿å…é€²å ´è§¸ç™¼èˆŠå‹•ç•«
    let lastEmojiTime = Date.now(); // é¿å…é€²å ´è§¸ç™¼èˆŠè¡¨æƒ…
    let emojiSpamCount = 0;
    let emojiResetTimer = null;
    const labels = {1:'A', 11:'J', 12:'Q', 13:'K'};

    // æ ¸å¿ƒå¾ªç’°ï¼šç›£æ§å€’æ•¸èˆ‡æˆ¿ä¸»é‚è¼¯
    setInterval(() => {
        if (!localData.players) return;
        const pKeys = Object.keys(localData.players);
        
        // è‹¥å®Œå…¨æ²’äººï¼Œç³»çµ±é‚„åŸ
        if (pKeys.length === 0 && localData.gameStarted) {
            gameRef.update({ gameStarted: false, c1:null, c2:null, c3:null });
            return;
        }

        if (!localData.gameStarted) return;

        const currentPlayerId = localData.currentPlayerKey;
        // å¦‚æœç•¶å‰ç©å®¶ä¸è¦‹äº†ï¼Œè‡ªå‹•æ›ä¸‹ä¸€ä½
        if (currentPlayerId && !localData.players[currentPlayerId]) {
            const nextK = pKeys[0];
            gameRef.update({ gameState: 'waiting_deal', currentPlayerKey: nextK, lastActionTime: firebase.database.ServerValue.TIMESTAMP });
            return;
        }

        // å€’æ•¸è¨ˆæ™‚åˆ¤å®š (åƒ…æˆ¿ä¸»ç«¯åŸ·è¡Œè¸¢é™¤æ¸›å°‘è¡çª)
        if (pKeys[0] === myId && localData.lastActionTime) {
            const diff = (Date.now() - localData.lastActionTime) / 1000;
            if (diff > 60.5) {
                gameRef.child('players/' + currentPlayerId).remove().then(() => {
                    const remainingKeys = Object.keys(localData.players).filter(k => k !== currentPlayerId);
                    const nextK = remainingKeys.length > 0 ? remainingKeys[0] : null;
                    gameRef.update({ 
                        gameState: 'waiting_deal', 
                        currentPlayerKey: nextK, 
                        statusMsg: "ç©å®¶è¶…æ™‚è¢«è¸¢å‡º", 
                        lastActionTime: firebase.database.ServerValue.TIMESTAMP 
                    });
                });
            }
        }
        renderPlayers();
    }, 1000);

    function togglePlayers() {
        const wrapper = document.getElementById('player-area-wrapper');
        wrapper.style.display = (wrapper.style.display === 'none') ? 'block' : 'none';
    }

    function joinRoom() {
        const nameInput = document.getElementById('my-name').value.trim();
        if (!nameInput) return alert("è«‹è¼¸å…¥æš±ç¨±");
        gameRef.child('players').once('value', snap => {
            const players = snap.val() || {};
            if (!myId || !players[myId]) {
                const newRef = gameRef.child('players').push();
                myId = newRef.key;
                localStorage.setItem('dg_id', myId);
            }
            // é€²å…¥æ™‚åŒæ­¥åˆå§‹åŒ–æ™‚é–“æˆ³ï¼Œé˜²æ­¢èˆŠå‹•ç•«
            gameRef.child('players/'+myId).update({ name: nameInput, lastActive: Date.now() });
            gameRef.once('value', s => {
                const d = s.val();
                if(d) {
                    if(d.allInTrigger) lastEffectId = d.allInTrigger;
                    if(d.lastEmoji) lastEmojiTime = d.lastEmoji.time;
                }
                startListening();
            });
            document.getElementById('login-part').style.display = 'none';
        });
    }

    function startListening() {
        gameRef.on('value', snap => {
            localData = snap.val() || {};
            if (!localData.players || !localData.players[myId]) return;

            const pKeys = Object.keys(localData.players);
            const isHost = (pKeys[0] === myId);
            document.body.className = isHost ? "is-host" : "";

            // è¡¨æƒ…ç›£è½ (éæ¿¾èˆŠè¡¨æƒ…)
            if (localData.lastEmoji && localData.lastEmoji.time > lastEmojiTime) {
                showEmojiBroadcast(localData.lastEmoji.name, localData.lastEmoji.icon);
                lastEmojiTime = localData.lastEmoji.time;
            }

            // All-in ç›£è½ (éæ¿¾èˆŠå‹•ç•«)
            if (localData.allInTrigger && localData.allInTrigger !== lastEffectId) {
                const videoBox = document.getElementById('video-box');
                videoBox.innerHTML = `<video width="315" height="560" autoplay playsinline><source src="video/allin.mp4" type="video/mp4"></video>`;
                document.getElementById('all-in-overlay').style.display = 'flex';
                setTimeout(() => { document.getElementById('all-in-overlay').style.display = 'none'; }, 2500);
                lastEffectId = localData.allInTrigger;
            }

            if (localData.gameStarted) {
                document.getElementById('setup-area').style.display = 'none';
                document.getElementById('main-board').style.display = 'block';
                renderUI(isHost);
            } else {
                document.getElementById('setup-area').style.display = 'block';
                document.getElementById('host-part').style.display = isHost ? 'block' : 'none';
                document.getElementById('main-board').style.display = 'none';
            }
            document.getElementById('host-controls').style.display = isHost ? 'block' : 'none';
            renderPlayers();
        });
    }

    function sendEmoji(icon) {
        if (!emojiResetTimer) { emojiResetTimer = setTimeout(() => { emojiSpamCount = 0; emojiResetTimer = null; }, 10000); }
        if (emojiSpamCount >= 3) return alert("10ç§’å…§é™ç™¼3æ¬¡");
        emojiSpamCount++;
        gameRef.update({ lastEmoji: { name: localData.players[myId].name, icon: icon, time: firebase.database.ServerValue.TIMESTAMP } });
    }

    function showEmojiBroadcast(name, icon) {
        const area = document.getElementById('emoji-broadcast-area');
        const div = document.createElement('div');
        div.className = 'broadcast-item';
        div.innerText = `${name}: ${icon}`;
        area.appendChild(div);
        setTimeout(() => div.remove(), 2500);
    }

    function addBet(val) {
        let current = parseInt(document.getElementById('bet-amount').value) || 0;
        let pool = localData.pool || 0;
        document.getElementById('bet-amount').value = Math.min(current + val, pool);
    }

    function renderPlayers() {
        const area = document.getElementById('player-area');
        area.innerHTML = '';
        const players = localData.players || {};
        const pKeys = Object.keys(players);
        
        pKeys.forEach((id, index) => {
            const p = players[id];
            const isActive = (id === localData.currentPlayerKey);
            const isMe = (id === myId);
            const isRoomHost = (index === 0);

            const div = document.createElement('div');
            div.className = `player-card ${isActive ? 'active' : ''} ${isMe ? 'is-me' : ''}`;
            
            let crown = isRoomHost ? `<span class="is-host-icon">ğŸ‘‘</span>` : "";
            let timer = (isActive && localData.lastActionTime) ? `<div class="timer-display">â± ${Math.max(0, 60 - Math.floor((Date.now() - localData.lastActionTime) / 1000))}s</div>` : "";
            
            div.innerHTML = `
                <button class="kick-btn" onclick="kickPlayer('${id}')">âœ•</button>
                <b>${p.name}</b>${crown}<br>
                <span class="player-balance">$${p.balance}</span>
                ${timer}
            `;
            area.appendChild(div);
        });
    }

    function hostStartGame() {
        const fee = parseInt(document.getElementById('entry-fee').value) || 100;
        const start = parseInt(document.getElementById('start-balance').value) || 1000;
        const decks = parseInt(document.getElementById('deck-count').value) || 2;
        const refill = document.getElementById('auto-refill').checked;
        let players = localData.players, pool = 0;
        Object.keys(players).forEach(id => { players[id].balance = start - fee; pool += fee; });
        gameRef.update({
            gameStarted: true, deck: generateDecks(decks), pool: pool, entryFee: fee, 
            foldPenalty: parseInt(document.getElementById('fold-penalty').value) || 20,
            autoRefill: refill, deckCount: decks, gameState: 'waiting_deal', 
            currentPlayerKey: Object.keys(players)[0], players: players, 
            lastActionTime: firebase.database.ServerValue.TIMESTAMP, statusMsg: "æ–°å°å±€é–‹å§‹"
        });
    }

    function drawGoalPost() {
        let deck = localData.deck || [];
        if (deck.length < 3) deck = generateDecks(localData.deckCount || 2);
        const c1 = deck.pop(); const c2 = deck.pop();
        // ç™¼ç‰Œå‹•ä½œï¼Œå¼·åˆ¶åˆ·æ–°å€’æ•¸è¨ˆæ™‚
        gameRef.update({ 
            deck: deck, c1: c1, c2: c2, c3: null, 
            gameState: 'waiting_shoot', 
            lastActionTime: firebase.database.ServerValue.TIMESTAMP, 
            statusMsg: "è«‹ä¸‹æ³¨å°„é–€" 
        });
    }

    function handleAction(type) {
        let bet = Math.abs(parseInt(document.getElementById('bet-amount').value)) || 0;
        if (type !== 'fold' && (bet < 1 || bet > localData.pool)) return alert("è«‹ä¸‹æ³¨");
        let p = localData.players[myId], nBal = p.balance, nPool = localData.pool, msg = "", c3 = null, deck = localData.deck || [];
        
        if (type === 'fold') { nBal -= localData.foldPenalty; nPool += localData.foldPenalty; msg = `${p.name} æ£„ç‰Œ`; }
        else {
            if (deck.length < 1) deck = generateDecks(localData.deckCount || 2);
            c3 = deck.pop();
            const min = Math.min(localData.c1.val, localData.c2.val), max = Math.max(localData.c1.val, localData.c2.val);
            if (localData.c1.val === localData.c2.val) {
                if (c3.val === localData.c1.val) { nBal -= bet*3; nPool += bet*3; msg = `æ’æŸ± (-$${bet*3})`; }
                else if ((type === 'up' && c3.val > localData.c1.val) || (type === 'down' && c3.val < localData.c1.val)) { nBal += bet; nPool -= bet; msg = `çŒœå° (+$${bet})`; }
                else { nBal -= bet; nPool += bet; msg = `çŒœéŒ¯ (-$${bet})`; }
            } else {
                if (c3.val > min && c3.val < max) { nBal += bet; nPool -= bet; msg = `å°„é€² (+$${bet})`; }
                else if (c3.val === min || c3.val === max) { nBal -= bet*2; nPool += bet*2; msg = `æ’æŸ± (-$${bet*2})`; }
                else { nBal -= bet; nPool += bet; msg = `æ²’é€² (-$${bet})`; }
            }
        }

        const pKeys = Object.keys(localData.players);
        let nextK = pKeys[(pKeys.indexOf(myId) + 1) % pKeys.length];
        // å‹•ä½œå®Œæˆï¼Œå¼·åˆ¶åˆ·æ–°å€’æ•¸çµ¦ä¸‹ä¸€å®¶
        let updates = { 
            [`players/${myId}/balance`]: nBal, pool: nPool, deck: deck, c3: c3 || null, 
            statusMsg: msg, gameState: 'waiting_deal', 
            currentPlayerKey: nextK, 
            lastActionTime: firebase.database.ServerValue.TIMESTAMP 
        };
        
        if (localData.autoRefill && nPool < localData.entryFee * pKeys.length) {
            pKeys.forEach(k => { let bal = (k === myId) ? nBal : localData.players[k].balance; updates[`players/${k}/balance`] = bal - localData.entryFee; updates.pool += localData.entryFee; });
        }
        gameRef.update(updates);
        document.getElementById('bet-amount').value = 0;
    }

    function renderUI(isHost) {
        document.getElementById('pool-val').innerText = localData.pool || 0;
        document.getElementById('status-msg').innerText = localData.statusMsg || "";
        document.getElementById('cards-left').innerText = localData.deck ? localData.deck.length : 0;
        document.getElementById('fold-cost-ui').innerText = localData.foldPenalty || 20;
        updateCard('c1', localData.c1); updateCard('c2', localData.c2); updateCard('c3', localData.c3);
        const isTurn = (localData.currentPlayerKey === myId);
        document.getElementById('player-deal-btn').style.display = (isTurn && localData.gameState === 'waiting_deal') ? 'block' : 'none';
        document.getElementById('bet-controls').style.display = (isTurn && localData.gameState === 'waiting_shoot') ? 'block' : 'none';
        const isSame = localData.c1 && localData.c2 && localData.c1.val === localData.c2.val;
        document.getElementById('shoot-normal').style.display = isSame ? 'none' : 'inline-block';
        document.getElementById('guess-buttons').style.display = isSame ? 'inline-block' : 'none';
    }

    function setAllIn() { if (confirm("ğŸ”¥ ç¢ºå®š ALL INï¼Ÿ")) { gameRef.update({ allInTrigger: Date.now().toString() }); document.getElementById('bet-amount').value = localData.pool; } }
    function updateCard(id, c) { const el = document.getElementById(id); if (!c) { el.classList.add('hidden'); el.innerText = '?'; } else { el.classList.remove('hidden'); el.innerText = `${c.suit}\n${c.label}`; el.classList.toggle('red', c.suit === 'â™¥' || c.suit === 'â™¦'); } }
    function generateDecks(count) { let deck = []; const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£']; for (let i = 0; i < count; i++) suits.forEach(s => { for (let v = 1; v <= 13; v++) deck.push({ val: v, suit: s, label: labels[v] || v }); }); return deck.sort(() => Math.random() - 0.5); }
    function kickPlayer(id) { if(confirm("ç¢ºå®šå‰”é™¤è©²ç©å®¶ï¼Ÿ")) gameRef.child('players/'+id).remove(); }
    function hostResetToLobby() { if(confirm("ç¢ºå®šé‡è£½å›è¨­å®šç•«é¢ï¼Ÿæ‰€æœ‰é¤˜é¡å°‡é‡åˆ·ã€‚")) gameRef.update({ gameStarted: false }); }
</script>
</body>
</html>
